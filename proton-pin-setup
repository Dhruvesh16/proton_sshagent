#!/bin/bash
# proton-pin-setup — DEPRECATED
#
# This script is no longer needed. The native SSH agent setup (1Password-style)
# uses Proton Pass's own biometric / master password as the gate.
# No separate PIN is required.
#
# This file is kept for backward compatibility only.

echo "╔════════════════════════════════════════════════════════╗"
echo "║  proton-pin-setup is DEPRECATED                       ║"
echo "║                                                       ║"
echo "║  The native SSH agent (1Password-style) uses Proton   ║"
echo "║  Pass's own unlock mechanism. No separate PIN needed. ║"
echo "║                                                       ║"
echo "║  Just lock/unlock via the Proton Pass desktop app.    ║"
echo "╚════════════════════════════════════════════════════════╝"
echo ""

# Legacy code below — only runs if user explicitly confirms
read -r -p "Set a legacy PIN anyway? [y/N] " confirm
[[ "$confirm" =~ ^[Yy] ]] || exit 0

PIN_HASH_FILE="$HOME/.config/proton-pass-pin-hash"
mkdir -p "$(dirname "$PIN_HASH_FILE")"

while true; do
    read -s -p "Enter PIN: " pin
    echo
    if [ -z "$pin" ]; then
        echo "PIN cannot be empty."
        continue
    fi
    read -s -p "Confirm PIN: " pin2
    echo
    if [ "$pin" != "$pin2" ]; then
        echo "PINs don't match. Try again."
        continue
    fi
    break
done

echo -n "$pin" | sha256sum | cut -d' ' -f1 > "$PIN_HASH_FILE"
chmod 600 "$PIN_HASH_FILE"
echo "Legacy PIN saved."
